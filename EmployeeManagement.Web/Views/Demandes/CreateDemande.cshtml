@model StockManagement.Application.Features.Demandes.DTOs.CreateDemandeDTO

<head>
    <link rel="stylesheet" href="~/css/CreateDemande.css">
</head>

<div class="create-demande-container">
    <h1 class="page-title">Créer une Demande</h1>

    <!-- Affichage des erreurs globales -->
    @if (!ViewData.ModelState.IsValid)
    {
        <div class="alert alert-danger">
            <ul>
                @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                {
                    <li>@error.ErrorMessage</li>
                }
            </ul>
        </div>
    }

    <form method="post" asp-action="CreateDemande" asp-controller="Demandes" class="form-create-demande">
        <div class="form-group">
            <label for="username">Nom d'utilisateur</label>
            <input type="text" id="username" class="form-control" value="@Model.UserName" readonly>
        </div>

        <div class="form-group">
            <label for="produits">Produits</label>
            <div id="produits">
                @if (Model.AvailableProduits != null && Model.AvailableProduits.Any())
                {
                    int index = 0;
                    @foreach (var produit in Model.AvailableProduits)
                    {
                        <div class="produit-row d-flex align-items-center mb-2">
                            <span class="produit-name mr-2">@produit.Name</span>
                            <input type="hidden" name="AvailableProduits[@index].Id" value="@produit.Id">
                            <input type="number" name="AvailableProduits[@index].Quantité"
                                   placeholder="Quantité (optionnelle)"
                                   class="form-control produit-quantite"
                                   min="0">
                        </div>
                        index++;
                    }
                }
                else
                {
                    <p>Aucun produit disponible.</p>
                }
            </div>
        </div>

        <!-- Actions du formulaire -->
        <div class="form-actions mt-4">
            <button type="submit" class="btn btn-primary">Soumettre</button>
            <a href="/Demandes/GetListDemandesByUserId" class="btn btn-secondary">Annuler</a>
        </div>
    </form>
</div>
